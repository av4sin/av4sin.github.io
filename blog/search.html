---
layout: default
title: Buscar
permalink: /blog/search.html
---

<div class="search-page">
    <header class="search-header">
        <h1>Buscar en el Blog</h1>
        <p>Encuentra articulos por texto, fecha, categoria o etiqueta</p>
    </header>

    <!-- Barra de busqueda principal -->
    <div class="search-main">
        <div class="search-input-wrapper">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search-input" class="search-input" placeholder="Escribe para buscar... (ej: fedora, linux, porque)" autocomplete="off">
            <button id="clear-search" class="clear-btn" title="Limpiar">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Filtros -->
    <div class="search-filters">
        <button id="toggle-filters" class="toggle-filters-btn">
            <i class="fas fa-sliders-h"></i> Filtros avanzados
        </button>

        <div id="filters-panel" class="filters-panel">
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label"><i class="fas fa-calendar"></i> Desde</label>
                    <input type="date" id="date-from" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label"><i class="fas fa-calendar"></i> Hasta</label>
                    <input type="date" id="date-to" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label"><i class="fas fa-folder"></i> Categoria</label>
                    <select id="filter-category" class="filter-select">
                        <option value="">Todas</option>
                    </select>
                </div>
            </div>
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label"><i class="fas fa-tags"></i> Etiqueta</label>
                    <select id="filter-tag" class="filter-select">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label"><i class="fas fa-align-left"></i> Longitud</label>
                    <select id="filter-length" class="filter-select">
                        <option value="">Cualquiera</option>
                        <option value="short">Corto (menos de 500 palabras)</option>
                        <option value="medium">Medio (500-1500 palabras)</option>
                        <option value="long">Largo (mas de 1500 palabras)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label"><i class="fas fa-sort"></i> Ordenar</label>
                    <select id="filter-sort" class="filter-select">
                        <option value="relevance">Relevancia</option>
                        <option value="date-desc">Mas reciente</option>
                        <option value="date-asc">Mas antiguo</option>
                        <option value="length-desc">Mas largo</option>
                        <option value="length-asc">Mas corto</option>
                    </select>
                </div>
            </div>
            <div class="filters-actions">
                <button id="reset-filters" class="btn-reset">
                    <i class="fas fa-undo"></i> Restablecer filtros
                </button>
            </div>
        </div>
    </div>

    <!-- Resultados -->
    <div class="search-results-wrapper">
        <div id="search-stats" class="search-stats"></div>
        <div id="search-results" class="search-results">
            <div class="search-placeholder">
                <i class="fas fa-search"></i>
                <p>Escribe algo para comenzar a buscar</p>
            </div>
        </div>
    </div>
</div>

<style>
.search-page {
    max-width: 900px;
    margin: 0 auto;
    padding: calc(70px + 2rem) 1rem 2rem;
}

.search-header {
    text-align: center;
    margin-bottom: 2rem;
}

.search-header h1 {
    font-size: 2.5rem;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.search-header p {
    color: var(--text-muted);
    font-size: 1.1rem;
}

/* Barra de busqueda */
.search-main {
    margin-bottom: 1.5rem;
}

.search-input-wrapper {
    position: relative;
}

.search-icon {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.3rem;
    color: var(--text-muted);
    pointer-events: none;
}

.search-input {
    width: 100%;
    padding: 20px 50px 20px 55px;
    font-size: 1.2rem;
    border: 2px solid var(--border);
    border-radius: 16px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    transition: 0.3s ease;
    box-sizing: border-box;
}

.search-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(22, 160, 133, 0.2);
}

.search-input::placeholder {
    color: var(--text-muted);
}

.clear-btn {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    padding: 8px;
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    opacity: 0;
    transition: 0.3s ease;
}

.clear-btn.visible {
    opacity: 1;
}

.clear-btn:hover {
    color: var(--accent);
}

/* Filtros */
.search-filters {
    margin-bottom: 1.5rem;
    text-align: center;
}

.toggle-filters-btn {
    padding: 10px 20px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: 0.3s ease;
    font-size: 0.95rem;
}

.toggle-filters-btn:hover {
    background: var(--bg-tertiary);
    color: var(--accent);
}

.toggle-filters-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

.filters-panel {
    display: none;
    margin-top: 1rem;
    padding: 1.5rem;
    background: var(--bg-secondary);
    border-radius: 12px;
    border: 1px solid var(--border);
    text-align: left;
}

.filters-panel.open {
    display: block;
}

.filters-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

.filter-group {
    flex: 1;
    min-width: 150px;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-label {
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.filter-label i {
    margin-right: 5px;
    color: var(--accent);
}

.filter-input,
.filter-select {
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.9rem;
    width: 100%;
    box-sizing: border-box;
}

.filter-input:focus,
.filter-select:focus {
    outline: none;
    border-color: var(--accent);
}

.filters-actions {
    text-align: center;
    margin-top: 0.5rem;
}

.btn-reset {
    padding: 8px 16px;
    background: var(--bg-tertiary);
    border: none;
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 0.9rem;
    transition: 0.3s ease;
}

.btn-reset:hover {
    background: var(--border);
    color: var(--text-primary);
}

/* Estadisticas */
.search-stats {
    padding: 0.75rem 0;
    font-size: 0.95rem;
    color: var(--text-muted);
}

/* Resultados */
.search-results {
    min-height: 200px;
}

.search-placeholder {
    text-align: center;
    padding: 3rem;
    color: var(--text-muted);
}

.search-placeholder i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    opacity: 0.5;
}

.search-placeholder p {
    font-size: 1.1rem;
}

/* Tarjeta de resultado */
.result-card {
    padding: 1.25rem;
    margin-bottom: 1rem;
    background: var(--bg-secondary);
    border-radius: 12px;
    border: 1px solid var(--border);
    transition: 0.3s ease;
}

.result-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
}

.result-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 0.5rem 0;
}

.result-title a {
    color: var(--text-primary);
    text-decoration: none;
}

.result-title a:hover {
    color: var(--accent);
}

.result-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
}

.result-meta i {
    margin-right: 4px;
}

.result-excerpt {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 0.75rem;
    font-size: 0.95rem;
}

.result-excerpt mark {
    background: rgba(22, 160, 133, 0.3);
    color: inherit;
    padding: 1px 3px;
    border-radius: 3px;
}

.result-footer {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.result-category {
    padding: 4px 10px;
    background: rgba(22, 160, 133, 0.15);
    color: var(--accent);
    border-radius: 4px;
    font-size: 0.8rem;
}

.result-tag {
    padding: 4px 8px;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    border-radius: 4px;
    font-size: 0.75rem;
}

/* Sin resultados */
.no-results {
    text-align: center;
    padding: 3rem;
    color: var(--text-muted);
}

.no-results i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    opacity: 0.5;
}

/* Responsive */
@media (max-width: 600px) {
    .search-header h1 {
        font-size: 1.8rem;
    }
    
    .search-input {
        padding: 15px 45px 15px 50px;
        font-size: 1rem;
    }
    
    .filters-row {
        flex-direction: column;
    }
    
    .filter-group {
        min-width: 100%;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let posts = [];
    let allCategories = new Set();
    let allTags = new Set();
    
    // Cargar posts - usar baseurl de Jekyll
    const searchUrl = '{{ site.baseurl }}/search.json';
    console.log('Cargando desde:', searchUrl);
    
    fetch(searchUrl)
        .then(response => {
            console.log('Response status:', response.status);
            if (!response.ok) throw new Error('HTTP ' + response.status);
            return response.text();
        })
        .then(text => {
            // Limpiar posibles caracteres problematicos
            try {
                return JSON.parse(text);
            } catch (e) {
                console.error('Error parseando JSON:', e);
                console.log('Primeros 500 chars:', text.substring(0, 500));
                throw e;
            }
        })
        .then(data => {
            posts = data;
            console.log('Posts cargados:', posts.length);
            // Extraer categorias y tags
            posts.forEach(post => {
                if (post.categories) post.categories.forEach(cat => allCategories.add(cat));
                if (post.tags) post.tags.forEach(tag => allTags.add(tag));
            });
            populateFilters();
        })
        .catch(error => {
            console.error('Error cargando posts:', error);
            document.getElementById('search-results').innerHTML = 
                '<div class="no-results"><i class="fas fa-exclamation-triangle"></i><p>Error cargando datos. Abre la consola (F12) para ver detalles.</p></div>';
        });
    
    // Elementos del DOM
    const searchInput = document.getElementById('search-input');
    const clearBtn = document.getElementById('clear-search');
    const toggleFiltersBtn = document.getElementById('toggle-filters');
    const filtersPanel = document.getElementById('filters-panel');
    const resetFiltersBtn = document.getElementById('reset-filters');
    const resultsContainer = document.getElementById('search-results');
    const statsContainer = document.getElementById('search-stats');
    
    // Toggle filtros
    toggleFiltersBtn.addEventListener('click', function() {
        filtersPanel.classList.toggle('open');
        this.classList.toggle('active');
    });
    
    // Busqueda en tiempo real con debounce
    let searchTimeout;
    searchInput.addEventListener('input', function() {
        clearBtn.classList.toggle('visible', this.value.length > 0);
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(performSearch, 150);
    });
    
    // Limpiar busqueda
    clearBtn.addEventListener('click', function() {
        searchInput.value = '';
        clearBtn.classList.remove('visible');
        performSearch();
    });
    
    // Cambios en filtros activan busqueda automatica
    ['filter-category', 'filter-tag', 'filter-length', 'filter-sort', 'date-from', 'date-to'].forEach(id => {
        document.getElementById(id).addEventListener('change', performSearch);
    });
    
    // Restablecer filtros
    resetFiltersBtn.addEventListener('click', function() {
        document.getElementById('date-from').value = '';
        document.getElementById('date-to').value = '';
        document.getElementById('filter-category').value = '';
        document.getElementById('filter-tag').value = '';
        document.getElementById('filter-length').value = '';
        document.getElementById('filter-sort').value = 'relevance';
        performSearch();
    });
    
    // Poblar filtros
    function populateFilters() {
        const categorySelect = document.getElementById('filter-category');
        const tagSelect = document.getElementById('filter-tag');
        
        Array.from(allCategories).sort().forEach(cat => {
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = cat;
            categorySelect.appendChild(option);
        });
        
        Array.from(allTags).sort().forEach(tag => {
            const option = document.createElement('option');
            option.value = tag;
            option.textContent = tag;
            tagSelect.appendChild(option);
        });
    }
    
    // Realizar busqueda
    function performSearch() {
        const query = searchInput.value.toLowerCase().trim();
        const dateFrom = document.getElementById('date-from').value;
        const dateTo = document.getElementById('date-to').value;
        const category = document.getElementById('filter-category').value.toLowerCase();
        const tag = document.getElementById('filter-tag').value.toLowerCase();
        const length = document.getElementById('filter-length').value;
        const sort = document.getElementById('filter-sort').value;
        
        let results = posts.filter(post => {
            // Filtro de texto - buscar en titulo, contenido, tags y categorias
            if (query) {
                const searchText = query.toLowerCase();
                const titleMatch = post.title && post.title.toLowerCase().includes(searchText);
                const contentMatch = post.content && post.content.toLowerCase().includes(searchText);
                const tagMatch = post.tags && post.tags.some(t => t.toLowerCase().includes(searchText));
                const catMatch = post.categories && post.categories.some(c => c.toLowerCase().includes(searchText));
                
                if (!titleMatch && !contentMatch && !tagMatch && !catMatch) {
                    return false;
                }
            }
            
            // Filtro de fecha
            if (dateFrom && post.date < dateFrom) return false;
            if (dateTo && post.date > dateTo) return false;
            
            // Filtro de categoria
            if (category && post.categories) {
                const hasCategory = post.categories.some(c => c.toLowerCase() === category);
                if (!hasCategory) return false;
            }
            
            // Filtro de tag
            if (tag && post.tags) {
                const hasTag = post.tags.some(t => t.toLowerCase() === tag);
                if (!hasTag) return false;
            }
            
            // Filtro de longitud
            if (length) {
                const words = post.words || 0;
                if (length === 'short' && words >= 500) return false;
                if (length === 'medium' && (words < 500 || words > 1500)) return false;
                if (length === 'long' && words <= 1500) return false;
            }
            
            return true;
        });
        
        // Calcular relevancia
        results = results.map(post => {
            let relevance = 0;
            if (query) {
                const q = query.toLowerCase();
                // Titulo tiene mas peso
                if (post.title && post.title.toLowerCase().includes(q)) {
                    relevance += 100;
                    // Bonus si empieza con la query
                    if (post.title.toLowerCase().startsWith(q)) relevance += 50;
                }
                // Contenido
                if (post.content) {
                    const matches = (post.content.toLowerCase().match(new RegExp(escapeRegex(q), 'g')) || []).length;
                    relevance += matches * 2;
                }
                // Tags
                if (post.tags && post.tags.some(t => t.toLowerCase().includes(q))) {
                    relevance += 30;
                }
                // Categorias
                if (post.categories && post.categories.some(c => c.toLowerCase().includes(q))) {
                    relevance += 20;
                }
            }
            return { ...post, relevance };
        });
        
        // Ordenar
        results.sort((a, b) => {
            switch (sort) {
                case 'relevance':
                    if (b.relevance !== a.relevance) return b.relevance - a.relevance;
                    return new Date(b.date) - new Date(a.date);
                case 'date-desc':
                    return new Date(b.date) - new Date(a.date);
                case 'date-asc':
                    return new Date(a.date) - new Date(b.date);
                case 'length-desc':
                    return (b.words || 0) - (a.words || 0);
                case 'length-asc':
                    return (a.words || 0) - (b.words || 0);
                default:
                    return 0;
            }
        });
        
        displayResults(results, query);
    }
    
    // Mostrar resultados
    function displayResults(results, query) {
        if (!query && !hasActiveFilters()) {
            resultsContainer.innerHTML = `
                <div class="search-placeholder">
                    <i class="fas fa-search"></i>
                    <p>Escribe algo para comenzar a buscar</p>
                </div>
            `;
            statsContainer.textContent = '';
            return;
        }
        
        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <p>No se encontraron resultados para "${escapeHtml(query)}"</p>
                </div>
            `;
            statsContainer.textContent = '0 resultados';
            return;
        }
        
        statsContainer.textContent = results.length + ' resultado' + (results.length !== 1 ? 's' : '') + ' encontrado' + (results.length !== 1 ? 's' : '');
        
        resultsContainer.innerHTML = results.map(post => {
            let excerpt = post.excerpt || '';
            if (query && excerpt) {
                const regex = new RegExp('(' + escapeRegex(query) + ')', 'gi');
                excerpt = excerpt.replace(regex, '<mark>$1</mark>');
            }
            
            const words = post.words || 0;
            const readingTime = Math.max(1, Math.ceil(words / 200));
            
            const categories = (post.categories || []).map(cat => 
                '<span class="result-category">' + escapeHtml(cat) + '</span>'
            ).join('');
            
            const tags = (post.tags || []).slice(0, 3).map(tag => 
                '<span class="result-tag">#' + escapeHtml(tag) + '</span>'
            ).join('');
            
            return `
                <div class="result-card">
                    <h3 class="result-title">
                        <a href="${post.url}">${highlightText(post.title, query)}</a>
                    </h3>
                    <div class="result-meta">
                        <span><i class="far fa-calendar"></i> ${formatDate(post.date)}</span>
                        <span><i class="far fa-clock"></i> ${readingTime} min</span>
                        <span><i class="fas fa-font"></i> ${words} palabras</span>
                    </div>
                    <p class="result-excerpt">${excerpt}</p>
                    <div class="result-footer">
                        ${categories}
                        ${tags}
                    </div>
                </div>
            `;
        }).join('');
    }
    
    // Utilidades
    function hasActiveFilters() {
        return document.getElementById('date-from').value ||
               document.getElementById('date-to').value ||
               document.getElementById('filter-category').value ||
               document.getElementById('filter-tag').value ||
               document.getElementById('filter-length').value;
    }
    
    function highlightText(text, query) {
        if (!query || !text) return escapeHtml(text || '');
        const regex = new RegExp('(' + escapeRegex(query) + ')', 'gi');
        return escapeHtml(text).replace(regex, '<mark>$1</mark>');
    }
    
    function escapeRegex(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }
    
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    function formatDate(dateStr) {
        if (!dateStr) return '';
        const date = new Date(dateStr);
        const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
        return date.getDate() + ' ' + months[date.getMonth()] + ' ' + date.getFullYear();
    }
});
</script>
